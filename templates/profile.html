<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Ñ–∏–ª—å {{ user.username }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

<div class="profile-top">

    <div class="profile-name">
        –ü—Ä–æ—Ñ–∏–ª—å: {{ user.username }}
    </div>

    <div class="profile-badges">

    {% if user.is_verified %}
        <span class="badge verified">‚úî</span>
    {% endif %}

    {% if user.is_admin %}
        <span class="badge admin">ADMIN</span>
    {% endif %}

    {% if user.rank == "WINE" %}
        <span class="badge wine">WINE</span>
    {% endif %}

    {% if user.rank == "LIQUOR" %}
        <span class="badge liquor">LIQUOR</span>
    {% endif %}

    <!-- üî• –í–û–¢ –≠–¢–û –î–û–ë–ê–í–¨ -->
    {% for badge in user.badges %}
        <span class="badge"
              style="background: {{ badge.color }};">
            {{ badge.name }}
        </span>
    {% endfor %}

</div>


</div>


    <!-- –ê–í–ê–¢–ê–† -->
    <div style="text-align:center; margin-bottom:20px;">
        <div onclick="toggleAvatarEdit()" style="cursor:pointer;">
            {% if user.avatar %}
                <img src="{{ url_for('static', filename='avatars/' + user.avatar) }}"
                     width="120" height="120"
                     style="border-radius:50%; object-fit:cover;">
            {% else %}
                <img src="{{ url_for('static', filename='avatars/default_avatar.png') }}"
                     width="120" height="120"
                     style="border-radius:50%; object-fit:cover;">
            {% endif %}
        </div>
    </div>

    <!-- –°–ú–ï–ù–ê –ê–í–ê–¢–ê–†–ê -->
    {% if user.username == current_user.username %}
    <form action="{{ url_for('upload_avatar') }}"
          method="POST"
          enctype="multipart/form-data"
          id="avatar-edit"
          style="text-align:center; margin-bottom:20px; display:none;">
        <input type="file" name="avatar" required>
        <button type="submit">–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
    </form>
    {% endif %}

    <p><strong>ID:</strong> {{ user.id }}</p>
    <p><strong>–°–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ:</strong> {{ user.messages|length }}</p>

    <hr>

    <!-- –ö–ù–û–ü–ö–ò -->
    <div class="button-group">

        {% if user.username != current_user.username %}
            <a class="btn"
               href="{{ url_for('dialog', username=user.username) }}">
                –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
            </a>
        {% endif %}

        <a class="btn" href="{{ url_for('chat') }}">–í –æ–±—â–∏–π —á–∞—Ç</a>

        <a class="btn"
           href="{{ url_for('profile', username=current_user.username) }}">
            –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
        </a>

        <a class="btn danger"
           href="{{ url_for('logout') }}">
            –í—ã–π—Ç–∏
        </a>

    </div>

    <hr>

    <!-- –û–ü–ò–°–ê–ù–ò–ï -->
    <div onclick="toggleBioEdit()" style="cursor:pointer;">
        <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>

        {% if user.bio %}
            <p>{{ user.bio }}</p>
        {% else %}
            <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª.</p>
        {% endif %}
    </div>

    {% if user.username == current_user.username %}
    <form action="{{ url_for('update_bio') }}"
          method="POST"
          id="bio-edit"
          style="display:none;">
        <textarea name="bio"
                  rows="3"
                  placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –æ —Å–µ–±–µ...">{{ user.bio }}</textarea>
        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ</button>
    </form>
    {% endif %}

    <hr>

    <!-- –ü–†–û–ß–ï–ï -->
    <div onclick="toggleExtraEdit()" style="cursor:pointer;">
        <h3>–ü—Ä–æ—á–µ–µ</h3>

        <div class="profile-extra">

            {% if user.marital_status %}
                <p><strong>–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ user.marital_status }}</p>
            {% endif %}
            {% if user.gender %}
                <p><strong>–ü–æ–ª:</strong> {{ user.gender }}</p>
            {% endif %}
            {% if user.address %}
                <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ user.address }}</p>
            {% endif %}
            {% if user.telegram %}
                <p><strong>Telegram:</strong> {{ user.telegram }}</p>
            {% endif %}
            {% if user.discord %}
                <p><strong>Discord:</strong> {{ user.discord }}</p>
            {% endif %}
            {% if user.email %}
                <p><strong>Email:</strong> {{ user.email }}</p>
            {% endif %}

        </div>
    </div>

    {% if user.username == current_user.username %}
    <form method="POST"
          action="{{ url_for('update_extra') }}"
          id="extra-edit"
          class="extra-form"
          style="display:none;">

        <label>–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ:</label>
        <select name="marital_status">
            <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
            <option value="–ñ–µ–Ω–∞—Ç">–ñ–µ–Ω–∞—Ç</option>
            <option value="–ù–µ –∂–µ–Ω–∞—Ç">–ù–µ –∂–µ–Ω–∞—Ç</option>
        </select>

        <label>–ü–æ–ª:</label>
        <select name="gender">
            <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
            <option value="–ú—É–∂—Å–∫–æ–π">–ú—É–∂—Å–∫–æ–π</option>
            <option value="–°—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
            <option value="–ñ–µ–Ω—Å–∫–∏–π">–ñ–µ–Ω—Å–∫–∏–π</option>
            <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
        </select>

        <label>–ê–¥—Ä–µ—Å:</label>
        <input type="text" name="address">

        <label>Telegram:</label>
        <input type="text" name="telegram">

        <label>Discord:</label>
        <input type="text" name="discord">

        <label>Email:</label>
        <input type="email" name="email">

        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

    </form>
    {% endif %}

</div>

<script>
function toggleAvatarEdit(){
    const el = document.getElementById("avatar-edit");
    if(el){
        el.style.display = el.style.display === "none" ? "block" : "none";
    }
}

function toggleBioEdit(){
    const el = document.getElementById("bio-edit");
    if(el){
        el.style.display = el.style.display === "none" ? "block" : "none";
    }



}

function toggleExtraEdit(){
    const el = document.getElementById("extra-edit");
    if(el){
        el.style.display = el.style.display === "none" ? "block" : "none";
    }
}
</script>

</body>
</html>
